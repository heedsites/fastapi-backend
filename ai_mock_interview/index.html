<!DOCTYPE html>
<html>
<head>
  <title>AI Mock Interview</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { margin: 6px; padding: 6px; }
    #final { color: green; font-weight: bold; }
  </style>
</head>
<body>

<h2>AI Mock Interview</h2>

<input id="domain" placeholder="Enter any domain" size="40" />
<button onclick="startInterview()">Start Interview</button>

<h3 id="question"></h3>
<p><b>Difficulty:</b> <span id="difficulty">Easy</span></p>

<button onclick="startRecording()">üé§ Start Answer</button>
<button onclick="stopRecording()">‚èπ Stop</button>

<p><b>Your Answer:</b> <span id="answer"></span></p>

<p id="final"></p>

<script>
let mediaRecorder, audioChunks = [];
let sessionId = null;

async function startInterview() {
  const domain = document.getElementById("domain").value.trim();
  if (!domain) return alert("Enter a domain");

  const fd = new FormData();
  fd.append("domain", domain);

  const res = await fetch("http://127.0.0.1:8000/start", {
    method: "POST",
    body: fd
  });

  const data = await res.json();
  sessionId = data.session_id;

  document.getElementById("question").innerText = data.question;
  document.getElementById("difficulty").innerText = "Easy";
  document.getElementById("final").innerText = "";
}

async function startRecording() {
  audioChunks = [];
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
  mediaRecorder.start();
}

async function stopRecording() {
  mediaRecorder.stop();
  mediaRecorder.onstop = async () => {
    const blob = new Blob(audioChunks, { type: "audio/webm" });

    const fd = new FormData();
    fd.append("session_id", sessionId);
    fd.append("audio", blob, "answer.webm");

    const res = await fetch("http://127.0.0.1:8000/answer", {
      method: "POST",
      body: fd
    });

    const data = await res.json();

    if (data.error) {
      alert(data.error);
      return;
    }

    document.getElementById("answer").innerText = data.answer_text;

    // Interview finished
    if (data.interview_completed) {
      document.getElementById("final").innerText =
        "Final Feedback: " + data.final_feedback;
      document.getElementById("question").innerText =
        "Interview Completed üéâ";
      return;
    }

    // Continue interview
    document.getElementById("question").innerText = data.next_question;
    document.getElementById("difficulty").innerText =
      data.difficulty.toUpperCase();
  };
}
</script>

</body>
</html>
